---
title: "Olympic history (part 5): is there a home team advantage?"
date: '2018-xx-xx'
layout: post
tags: R olympics sports tidyr ggplot2
comments: true
---

```{r setup, include=FALSE}
# knitr settings
#knitr::opts_chunk$set(fig.path = "assets/Rfigs/", echo=FALSE, comment="> ", fig.align='center')
#knitr::opts_knit$set(base.dir = "/Users/nunnlab/Desktop/GitHub/rgriff23.github.io/", base.url = "/")
```

This is the fourth in a series of posts analyzing data on the modern Olympic Games.

Many factors determine a country's medal count in any given Olympics, and these factors vary from one Olympics to the next. In this post, I investigate whether being the home team increases a country's medal count on average, focusing on the Summer Games since they have a longe history and more countries involved. 'Home team advantage' has been reported in other contexts, such as... 

Before doing any statistical analysis, some data preparation is required. First, I compute the proportion of medals won by each NOC in each Summer Olympics. Second, I match each host city to a National Olympic Committee (NOC) to determine which NOC is the host of each Olympics. Third, I limit data to only NOCs that hosted the Olympics at least once. 

```{r}
# load packages 
library("tidyverse")

# add logical column for medaling
athlete_events <- mutate(athlete_events, Medal2 = !is.na(Medal))

# subset to summer data and compute proportion of medals won by each NOC
summer <- athlete_events %>% filter(Season == "Summer") %>% select(NOC, Year, City, Medal2)
summer_noc_counts <- summer %>% group_by(Year, NOC) %>% summarize(medals = sum(Medal2), City = head(City,1))
summer_totals <- summer %>% group_by(Year) %>% summarize(total_medals = sum(Medal2))
summer_props <- summer_noc_counts %>% left_join(summer_totals, by="Year") %>% mutate(proportion = round(medals/total_medals,3)) 

# there are 41 Olypic host cities to match with NOCs
summer_props %>% ungroup %>% select(City) %>% unique %>% length
summer_props %>% ungroup %>% select(City, Year) %>% unique %>% print(n=Inf)


# add 'home' 

```

I fit a mixed-effects model with 'home' as a fixed effect, 'country' as a random effect, and temporal autocorrelation within each country.  

```{r, message=FALSE}
# load package
library("nlme")

# model for Summer Games
lme.summer <- lme(proportion ~ home, 
                  random=~1|NOC, 
                  data=summer_data, 
                  correlation=corCAR1(form = ~Year|NOC))
```

Up next: Migrants, merceneries, and opportunists???

**Footnotes**

For a comprehensive history of the modern Olympics, I recommend ['Politics, Power, and the Olympic Games'](https://www.amazon.com/Power-Politics-Olympic-Games-Alfred/dp/0880119586/ref=sr_1_1?ie=UTF8&qid=1523105541&sr=8-1&keywords=politics+power+olympic+games) by Alfred Senn. It's a bit dry, but very thorough.

